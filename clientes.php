<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Twitter -->
    <meta name="twitter:site" content="@themepixels">
    <meta name="twitter:creator" content="@themepixels">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Slim">
    <meta name="twitter:description" content="Premium Quality and Responsive UI for Dashboard.">
    <meta name="twitter:image" content="http://themepixels.me/slim/img/slim-social.png">

    <!-- Facebook -->
    <meta property="og:url" content="http://themepixels.me/slim">
    <meta property="og:title" content="Slim">
    <meta property="og:description" content="Premium Quality and Responsive UI for Dashboard.">

    <meta property="og:image" content="http://themepixels.me/slim/img/slim-social.png">
    <meta property="og:image:secure_url" content="http://themepixels.me/slim/img/slim-social.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="600">

    <!-- Meta -->
    <meta name="description" content="Premium Quality and Responsive UI for Dashboard.">
    <meta name="author" content="ThemePixels">

    <title>Vates | Inteligência de risco</title>

    <!-- vendor css -->
    <link href="./lib/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="./lib/Ionicons/css/ionicons.css" rel="stylesheet">
    <link href="./lib/rickshaw/css/rickshaw.min.css" rel="stylesheet">

    <!-- Slim CSS -->
    <link rel="stylesheet" href="./css/slim.css">

  </head>
  <body class="dashboard-5">
    <div class="slim-header">
      <div class="container">
        <div class="slim-header-left">
          <h2 class="slim-logo"><a href="index.html"><img src="./img/logo.png" width="150"/></a></h2>

          <div class="search-box">
            <input type="text" class="form-control" placeholder="Buscar">
            <button class="btn btn-primary"><i class="fa fa-search"></i></button>
          </div><!-- search-box -->
        </div><!-- slim-header-left -->
        <div class="slim-header-right">
          <div class="dropdown dropdown-a">
            <!-- <a href="" class="header-notification" data-toggle="dropdown">
              <i class="icon ion-ios-bolt-outline"></i>
            </a> -->
            <div class="dropdown-menu">
              <div class="dropdown-menu-header">
                <h6 class="dropdown-menu-title">Activity Logs</h6>
                <div>
                  <a href="">Filter List</a>
                  <a href="">Settings</a>
                </div>
              </div><!-- dropdown-menu-header -->
              <div class="dropdown-activity-list">
                <div class="activity-label">Today, December 13, 2017</div>
                <div class="activity-item">
                  <div class="row no-gutters">
                    <div class="col-2 tx-right">10:15am</div>
                    <div class="col-2 tx-center"><span class="square-10 bg-success"></span></div>
                    <div class="col-8">Purchased christmas sale cloud storage</div>
                  </div><!-- row -->
                </div><!-- activity-item -->
                <div class="activity-item">
                  <div class="row no-gutters">
                    <div class="col-2 tx-right">9:48am</div>
                    <div class="col-2 tx-center"><span class="square-10 bg-danger"></span></div>
                    <div class="col-8">Login failure</div>
                  </div><!-- row -->
                </div><!-- activity-item -->
                <div class="activity-item">
                  <div class="row no-gutters">
                    <div class="col-2 tx-right">7:29am</div>
                    <div class="col-2 tx-center"><span class="square-10 bg-warning"></span></div>
                    <div class="col-8">(D:) Storage almost full</div>
                  </div><!-- row -->
                </div><!-- activity-item -->
                <div class="activity-item">
                  <div class="row no-gutters">
                    <div class="col-2 tx-right">3:21am</div>
                    <div class="col-2 tx-center"><span class="square-10 bg-success"></span></div>
                    <div class="col-8">1 item sold <strong>Christmas bundle</strong></div>
                  </div><!-- row -->
                </div><!-- activity-item -->
                <div class="activity-label">Yesterday, December 12, 2017</div>
                <div class="activity-item">
                  <div class="row no-gutters">
                    <div class="col-2 tx-right">6:57am</div>
                    <div class="col-2 tx-center"><span class="square-10 bg-success"></span></div>
                    <div class="col-8">Earn new badge <strong>Elite Author</strong></div>
                  </div><!-- row -->
                </div><!-- activity-item -->
              </div><!-- dropdown-activity-list -->
              <div class="dropdown-list-footer">
                <a href="page-activity.html"><i class="fa fa-angle-down"></i> Show All Activities</a>
              </div>
            </div><!-- dropdown-menu-right -->
          </div><!-- dropdown -->
          <div class="dropdown dropdown-b">
            <!-- <a href="" class="header-notification" data-toggle="dropdown">
              <i class="icon ion-ios-bell-outline"></i>
              <span class="indicator"></span>
            </a> -->
            <div class="dropdown-menu">
              <div class="dropdown-menu-header">
                <h6 class="dropdown-menu-title">Notifications</h6>
                <div>
                  <a href="">Mark All as Read</a>
                  <a href="">Settings</a>
                </div>
              </div><!-- dropdown-menu-header -->
              <div class="dropdown-list">
                <!-- loop starts here -->
                <a href="" class="dropdown-link">
                  <div class="media">
                    <img src="http://via.placeholder.com/500x500" alt="">
                    <div class="media-body">
                      <p><strong>Suzzeth Bungaos</strong> tagged you and 18 others in a post.</p>
                      <span>October 03, 2017 8:45am</span>
                    </div>
                  </div><!-- media -->
                </a>
                <!-- loop ends here -->
                <a href="" class="dropdown-link">
                  <div class="media">
                    <img src="http://via.placeholder.com/500x500" alt="">
                    <div class="media-body">
                      <p><strong>Mellisa Brown</strong> appreciated your work <strong>The Social Network</strong></p>
                      <span>October 02, 2017 12:44am</span>
                    </div>
                  </div><!-- media -->
                </a>
                <a href="" class="dropdown-link read">
                  <div class="media">
                    <img src="http://via.placeholder.com/500x500" alt="">
                    <div class="media-body">
                      <p>20+ new items added are for sale in your <strong>Sale Group</strong></p>
                      <span>October 01, 2017 10:20pm</span>
                    </div>
                  </div><!-- media -->
                </a>
                <a href="" class="dropdown-link read">
                  <div class="media">
                    <img src="http://via.placeholder.com/500x500" alt="">
                    <div class="media-body">
                      <p><strong>Julius Erving</strong> wants to connect with you on your conversation with <strong>Ronnie Mara</strong></p>
                      <span>October 01, 2017 6:08pm</span>
                    </div>
                  </div><!-- media -->
                </a>
                <div class="dropdown-list-footer">
                  <a href="page-notifications.html"><i class="fa fa-angle-down"></i> Show All Notifications</a>
                </div>
              </div><!-- dropdown-list -->
            </div><!-- dropdown-menu-right -->
          </div><!-- dropdown -->
          <div class="dropdown dropdown-c">
            <a href="#" class="logged-user" data-toggle="dropdown">
              <i class="icon ion-person tx-32"></i>
              <span>Admin</span>
              <i class="fa fa-angle-down"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-right">
              <nav class="nav">
                <a href="page-404.html" class="nav-link"><i class="icon ion-person"></i> Meu Perfil</a>
                <a href="page-404.html" class="nav-link"><i class="icon ion-ios-gear"></i> Configurações</a>
                <a href="page-signin2.html" class="nav-link"><i class="icon ion-forward"></i> Sair</a>
              </nav>
            </div><!-- dropdown-menu -->
          </div><!-- dropdown -->
        </div><!-- header-right -->
      </div><!-- container -->
    </div><!-- slim-header -->

    <div class="slim-navbar">
      <div class="container">
        <ul class="nav">
          <li class="nav-item with-sub active">
            <a class="nav-link" href="index5.html">
              <i class="icon ion-plus"></i>
              <span>CADASTROS</span>
            </a>
            <div class="sub-item">
              <ul>
                <li><a href="index.html">PRODUÇÃO/VENDA</a></li>
                <li><a href="index2.html">POSIÇÕES FINANCEIRAS</a></li>
                <li><a href="index3.html">CLIENTES</a></li>
                <li><a href="index4.html">CORRETORAS</a></li>
                <li><a href="index5.html">COTAÇÕES</a></li>
              </ul>
            </div>
          </li>
          <li class="nav-item with-sub">
            <a class="nav-link" href="fazendas.html">
              <i class="icon ion-pie-graph"></i>
              <span>ANÁLISES</span>
            </a>
            <div class="sub-item">
              <ul>
                <li><a href="index.html">RESUMO GERAL</a></li>
                <li><a href="index2.html">EXPOSIÇÃO FÍSICO</a></li>
                <li><a href="index3.html">EXPOSIÇÃO CAMBIAL</a></li>
                <li><a href="index4.html">CHAMADA DE MARGEM</a></li>
                <li><a href="index5.html">MTM</a></li>
              </ul>
            </div>
          </li>
        </ul>
      </div><!-- container -->
    </div><!-- slim-navbar -->

    <div class="slim-mainpanel">
      <div class="container pd-t-10">
        <div class="row">
          <div class="col-4">
            <h3 class="text-dark">CLIENTES</h3 class="text-dark">
            <p class="mg-b-20 mg-sm-b-40"></p>
          </div>
          <div class="col-8">
            <button class="btn btn-primary float-right" id="btnOpenAddModal"><i class="fa fa-plus"></i>&nbsp; Novo Cliente</button>
          </div>
        </div>
        <div id="tableFilter">
          <div class="row mb-3">
            <div class="col-4">
              <label>MERCADO</label>
              <select name="MERCADO" class="form-control">
                <option value="*" selected>TODOS</option>
                <option value="Estadual">ESTADUAL</option>
                <option value="Interno">INTERNO</option>
                <option value="Externo">EXTERNO</option>
              </select>
            </div>
            <div class="col-8">
              <button class="btn btn-primary btn-block rounded-30 mg-t-30" id="btnSearch"><i class="fa fa-search"></i>&nbsp; PESQUISAR</button>
            </div>
          </div>
        </div>
        <div class="table-responsive" id="tableSearch">
          <table class="table table-striped table-bordered mg-b-0">
            <thead class="thead-colored bg-info">
              <tr>
                <th>NOME</th>
                <th>CNPJ</th>
                <th>MERCADO</th>
                <th>AÇÕES</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>AMBEV</td>
                <td>-</td>
                <td>INTERNO</td>
              </tr>
              <tr>
                <td>ARCOR</td>
                <td>-</td>
                <td>ESTADUAL</td>
              </tr>
              <tr>
                <td>ASR</td>
                <td>-</td>
                <td>EXTERNO</td>
              </tr>
              <tr>
                <td>AMBEV</td>
                <td>-</td>
                <td>INTERNO</td>
              </tr>
            </tbody>
          </table>
        </div><!-- bd -->
        
      </div><!-- container -->
    </div><!-- slim-mainpanel -->

    <div class="slim-footer">
      <div class="container">
        <p>Copyright 2018 &copy; Todos os direitos reservados.</p>
      </div><!-- container -->
    </div><!-- slim-footer -->

    <div class="modal fade" tabindex="-1" role="dialog" id="modalNew">
      <div class="modal-dialog modal-lg" style="width: 100%" role="document">
        <div class="modal-content">
          <div class="modal-header pd-y-20 pd-x-25">
            <h6 class="tx-14 mg-b-0 tx-uppercase tx-inverse tx-bold">Cliente</h6>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="row">
                <div class="col-4">
                  <div class="form-group">
                    <label>NOME *</label>
                    <input type="text" class="form-control required" name="sRazaoSocial" id="">
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>CNPJ</label>
                    <input type="text" class="form-control" name="iCNPJ" id="">
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>MERCADO</label>
                    <select class="form-control" name="sMercado" id="">
                      <option value="" disabled selected>Selecione</option>
                      <option value="Estadual">Estadual</option>
                      <option value="Interno">Interno</option>
                      <option value="Externo">Externo</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label>LOGRADOURO</label>
                    <input type="text" class="form-control" name="logradouro" id="">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group">
                    <label>NÚMERO</label>
                    <input type="text" class="form-control" name="numero" id="">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group">
                    <label>COMPLEMENTO</label>
                    <input type="text" class="form-control" name="complemento" id="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-8">
                  <div class="form-group">
                    <label>BAIRRO</label>
                    <input type="text" class="form-control" name="bairro" id="">
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>CEP</label>
                    <input type="text" class="form-control" name="cep" id="">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label>CIDADE</label>
                    <input type="text" class="form-control" name="cidade" id="">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group">
                    <label>ESTADO</label>
                    <input type="text" class="form-control" name="estado" id="">
                  </div>
                </div>
                <div class="col-3">
                  <div class="form-group">
                    <label>PAÍS</label>
                    <input type="text" class="form-control" name="pais" id="">
                  </div>
                </div>
              </div>
              <!-- <div class="row d-none">
                <div class="col-4">
                  <div class="form-group">
                    <label>DIAS APÓS ENTREGA</label>
                    <input type="text" class="form-control" name="dtentrega" id="">
                  </div>
                </div>
                <div class="col-4">
                  <div class="form-group">
                    <label>DIAS APÓS ENTREGA</label>
                    <input type="text" class="form-control" name="dtentrega" id="">
                  </div>
                </div>
                <div class="col-4">
                  <label>MOEDA</label>
                  <select class="form-control" name="sMercado" id="">
                    <option value="" disabled selected>Selecione</option>
                    <option value="usd">DÓLAR</option>
                    <option value="gbp">GBP</option>
                    <option value="real">REAL</option>
                  </select>
                </div>
              </div> -->
            </form>
          </div><!-- modal-body -->
          <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" id="btnSaveModalNew">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalError">
      <div class="modal-dialog" role="document">
        <div class="modal-content tx-size-sm">
          <div class="modal-body tx-center pd-y-20 pd-x-20">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
            <i class="icon icon ion-ios-close-outline tx-100 tx-danger lh-1 mg-t-20 d-inline-block"></i>
            <h4 class="tx-danger mg-b-20">Alerta: Ocorreu um problema!</h4>
            <p class="mg-b-20 mg-x-20">Tente novamente em alguns instantes!</p>
            <button type="button" class="btn btn-danger pd-x-25" data-dismiss="modal" aria-label="Close">Ok</button>
          </div><!-- modal-body -->
        </div><!-- modal-content -->
      </div>
    </div>

    <div class="modal fade" id="modalSuccess">
      <div class="modal-dialog" role="document">
        <div class="modal-content tx-size-sm">
          <div class="modal-body tx-center pd-y-20 pd-x-20">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
            <i class="icon ion-ios-checkmark-outline tx-100 tx-success lh-1 mg-t-20 d-inline-block"></i>
            <h4 class="tx-success mg-b-20">Sucesso!</h4>
            <p class="mg-b-20 mg-x-20">Sua solicitação foi realizada com sucesso!</p>
            <button type="button" id="btnCloseSuccess" class="btn btn-success pd-x-25" data-dismiss="modal" aria-label="Close">Ok</button>
          </div><!-- modal-body -->
        </div><!-- modal-content -->
      </div>
    </div>

    <script src="./lib/jquery/js/jquery.js"></script>
    <script src="./lib/popper.js/js/popper.js"></script>
    <script src="./lib/bootstrap/js/bootstrap.js"></script>
    <script src="./lib/jquery.cookie/js/jquery.cookie.js"></script>
    <script src="./lib/d3/js/d3.js"></script>
    <script src="./lib/rickshaw/js/rickshaw.min.js"></script>
    <script src="./lib/chart.js/js/Chart.js"></script>

    <script src="./js/slim.js"></script>
    <script src="./js/ResizeSensor.js"></script>
    <script src="./js/functions.jquery.js"></script>
    <script src="./js/functions.js"></script>

    <script>
      $(document).ready(function() {
        $('#btnOpenAddModal').on('click', function() {
          $('#modalNew').modal('show');
        });

        $('#btnSaveModalNew').on('click', function() {
          let $form = $('#modalNew').find('form');
          if($form.validateForm()) {
            save();
          } else {
            $('#modalError').modal('show');
          }
        });

        $('#btnCloseSuccess').on('click', function() {
          $('#btnSearch').trigger('click');
        });

        $('#btnSearch').on('click', function() {
          search();
        });

        $('body').on('click', '.btnDelete', function() {
          let cliente = this.dataset.cod;

          deleteCliente(cliente);
        });

        function search() {
          let $table = $('#tableSearch');
          let $tbody = $table.find('tbody');
          let $filters = $('#tableFilter *').serializeJSON();
          let url = './services/cliente/search';

          let params = {
            type: 'vates',
            filter: $filters
          };

          let loader = `
            <tr>
              <td colspan=20 class="text-center">
                <i class="fa fa-refresh fa-spin fa-4x text-primary"></i>
              </td>
            </tr>
          `;

          let nilResult = `
            <tr>
              <td colspan=20 class="text-center text-primary font-weight-bold">
                <h3>Nenhum resultado encontrado...</h3>
              </td>
            </tr>
          `;

          $tbody.empty();
          $tbody.append(loader);

          $.post(url, params, function(resp) {
            if(resp.status === 0) {
              let data = resp.data;
              setTimeout(() => {
                $tbody.empty();
                
                if(data.length > 0) {
                  let row = '';
                  $.each(data, (i, e) => {

                    let btns = `
                      <button class="btn btn-warning btnEdit" data-cod="${e.id}" title="Editar"><i class="fa fa-pencil"></i></button>
                      <button class="btn btn-danger btnDelete" data-cod="${e.id}" title="Excluir"><i class="fa fa-trash"></i></button>
                    `;
                    row += `
                      <tr>
                        <td>${(e.sRazaoSocial).toUpperCase()}</td>
                        <td>${e.iCNPJ}</td>
                        <td>${(e.sMercado).toUpperCase()}</td>
                        <td class="text-center">${btns}</td>
                      </tr>
                    `;
                  });
  
                  $tbody.append(row);
                } else {
                  $tbody.append(nilResult);
                }
              }, 1000);

            } else {
              $('#modalError').modal('show');
            }
          }, 'json');
        }

        search();

        function deleteCliente(id) {
          let cliente = id;
          let url = './services/cliente/delete';
          let params = {
            type: 'vates',
            cliente: id
          };

          $.post(url, params, function(resp) {
            if(resp.status === 0) {
              $('#modalSuccess').modal('show');
            } else {
              $('#modalError').modal('show');
            }
          }, 'json');
        }

        function save() {
          let $modal = $('#modalNew');
          let $form = $modal.find('form');
          let data = $form.serializeJSON();
          
          let url = './services/cliente/add';
          let params = {
            type: 'vates',
            cliente: data
          };

          $.post(url, params, function(resp) {
            if(resp.status === 0) {
              $('#modalNew').modal('hide');
              $('#modalSuccess').modal('show');
            } else {
              $('#modalError').modal('show');
            }
          }, 'json');
        }
      });
    </script>
  </body>
</html>
